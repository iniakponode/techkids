{% extends "layout/base.html" %}

{% block title %}Payment{% endblock %}

{% block extra_head %}
<script src="/static/js/pages/payment.js" defer></script>
{% endblock %}

{% block content %}
<div class="container py-4">
  <div class="row justify-content-center">
    <div class="col-md-8">
      <h1 class="mb-4">Payment</h1>

      <!-- Store order info in a hidden div for JavaScript access -->
      <div id="orderInfo"
           data-order-id="{{ order.id }}"
           data-user-email="{{ order.user.email }}">
      </div>

      <div class="card">
        <div class="card-body">
          <p>Order ID: {{ order.id }}</p>
          <p>Amount Due: ₦{{ order.total_amount }}</p>
          <p>Status: {{ order.status }}</p>

          <!-- Display the registered courses for this order -->
          <h5 class="mt-3">Registered Courses:</h5>
          <ul>
            {% for registration in order.registration %}
              <li>{{ registration.course.title }} - ₦{{ registration.course.price }}</li>
            {% endfor %}
          </ul>

          {% if order.status != 'paid' %}
            <button id="payNowBtn" class="btn btn-success" data-loading-text="Processing...">
              Pay Now
              <span id="loadingSpinner" class="spinner-border spinner-border-sm" role="status" aria-hidden="true" style="display: none;"></span>
            </button>
          {% else %}
            <div class="alert alert-success">This order is already paid!</div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}